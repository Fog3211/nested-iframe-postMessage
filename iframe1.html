<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>new domain page</title>
  </head>
  <body style="background: pink">
    <p>Click the button below, send postMessage with old domain origin</p>
    <button id="btn1">send message</button>

    <script>
      const oldDomainLandingPage =
        'https://nested-iframe-post-message-old-domain.fog3211.vercel.app/iframe2.html';

      const childIframe = document.createElement('iframe');
      childIframe.style.display = 'none';
      childIframe.setAttribute('src', oldDomainLandingPage);
      console.log('insert empty iframe into document', window.location.href);
      document.body.appendChild(childIframe);

      document.querySelector('#btn1').addEventListener('click', () => {
        // new domain => old domain
        childIframe.contentWindow.postMessage(
          {
            _msgTarget: document.referrer,
          },
          oldDomainLandingPage
        );
      });
    </script>
  </body>
</html>
